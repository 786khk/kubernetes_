kublet - cadvisor가 있어 컨테이너 모니터링

### MasterNode
- 클러스터를 제어하고 관리하는 중심역할
###### 구성
- API server
    - kubectl로 받은 명령어 등을 입력받아 요청 처리
- Scheduler 
    - 어떤 노드에 자원을 배치할지 결정
- etcd 
    - 클러스터 관련 정보 키-값으로 저장
    -워커노드들에 대한 상태정보 저장
    - 컨테이너 동작상태, 컨테이너 이미지 상태 저장
- Controller Manager
    - 자원 모니터링
    - 현재 상태가 사용자 설정과 동일하도록 관리
- Core DNS 
    - 마스터노드를 설치할 때 자동으로 설치되는 애드온 프로그램
    - 클러스터 내부 파드에 DNS이름 할당, 이 DNS를 통해 서비스간 통신이나 파드간의 통신하게해줌
        - 클러스터 내부 서비스를 찾거나 통신하기 위애 DNS를 사용하는데 이를CoreDNS가 담당한다.


#### 컨트롤 플레인
- 시스템의 모든 컴포넌트
- 컴포넌트가 마스터 노드에 함께 구성되어 전체 시스템 구성
- 마스터 노드에 포함
- 사용자가 원하는 클러스터 상태(ex. yaml 파일 내용)를 모니터링하고 유지
- 새 노드 추가 또는 필요에 따라 노드 제거하는 클러스터확장 
- 새로운 파드 배포, 스케일 업, 다운
- 시스템 구성 업데이트, 클러스터 설정 관리



### WorkerNode

#### 데이터 플레인

- kublet
    - master node와 통신
    - 데콘형태로 존재
    - cadvisor가 있어 컨테이너 모니터링
    - 스케줄러가 특정 노드에 파드를 할당하면 kublet 해당파드에서 컨테니어 실행
- kube-proxy
    - 서비스IP와 파드IP를 변환한다.
    - ipTable rule 구성
    - CNI(Container Network Interface)
        - 오케스트레이션 시스템 내 네트워크설정하는데 사용되는 표준 인터페이스
        - 파드간 통신관리, 파드에IP 할당, 컨테이너 네트워크 제어
- container runtime engin
    - 컨테이너 실행을 위한 엔진 
    - 이 엔진중 하나다 docker

###### 이외 애드온
- 로깅(엘라스틱서치, 로그스태시, 키바나)


### 동작

1 `kubectl ~` 로 시작하는 명령어를 입력하면 master-node의 api server로 요청이 온다.
2 api server는 요청을 처리할 수 있는지 확인하고 실행
3 이 때 ETCD 저장소에 있는 worker node 정보를 api server에 전송한다.
4 api server는 scheduler에 어떤 worker node 가 적합할지 ETCD 저장소에서 전송된 노드 정보와 함께 요청을 보낸다.
5 scheduler는 api server에 응답한다.
6 api server는 kublet에 컨테이너를 실행 요청을 보낸다.
7 kublet에서 요청이 온 스팩대로 이미지를받아 컨테이너 실행
- node가 정지된다면 컨트롤플레인의 controller가 모니터링하고있는controller에서 감지 한 후 노드상태를 유지하기 위해 1~7순서를 다시반복

